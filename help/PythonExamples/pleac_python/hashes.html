<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Hashes</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Python
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Arrays"
HREF="arrays.html"><LINK
REL="NEXT"
TITLE="Pattern Matching"
HREF="patternmatching.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .py-builtins {
        /* py-builtins-face */
        color: #ffa500;
      }
      .py-pseudo-keyword {
        /* py-pseudo-keyword-face */
        color: #ffa500;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Python
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="patternmatching.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="HASHES"
>5. Hashes</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN232"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">dictionaries
</span>age = {<span class="string">"Nat"</span>: 24,
       <span class="string">"Jules"</span>: 24,
       <span class="string">"Josh"</span>: 17}
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>age = {}
age[<span class="string">"Nat"</span>] = 24
age[<span class="string">"Jules"</span>] = 25
age[<span class="string">"Josh"</span>] = 17
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>food_color = {<span class="string">"Apple"</span>:  <span class="string">"red"</span>,
              <span class="string">"Banana"</span>: <span class="string">"yellow"</span>,
              <span class="string">"Lemon"</span>:  <span class="string">"yellow"</span>,
              <span class="string">"Carrot"</span>: <span class="string">"orange"</span>
             }
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">NOTE: keys must be quoted in Python
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN235"
>Adding an Element to a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>mydict[key] = value
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">food_color defined per the introduction
</span>food_color[<span class="string">"Raspberry"</span>] = <span class="string">"pink"</span>
<span class="keyword">print</span> <span class="string">"Known foods:"</span>
<span class="keyword">for</span> food <span class="keyword">in</span> food_color:
    <span class="keyword">print</span> food

<span class="comment-delimiter">#</span><span class="comment">=&gt; Known foods:
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Raspberry
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Carrot
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Lemon
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Apple
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Banana
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN238"
>Testing for the Presence of a Key in a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter"># </span><span class="comment">does mydict have a value for key?
</span><span class="keyword">if</span> key <span class="keyword">in</span> mydict:
    <span class="keyword">pass</span> <span class="comment-delimiter"># </span><span class="comment">it exists
</span><span class="keyword">else:</span>
    <span class="keyword">pass</span> <span class="comment-delimiter"># </span><span class="comment">it doesn't
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">food_color per the introduction
</span><span class="keyword">for</span> name <span class="keyword">in</span> (<span class="string">"Banana"</span>, <span class="string">"Martini"</span>):
    <span class="keyword">if</span> name <span class="keyword">in</span> food_color:
        <span class="keyword">print</span> name, <span class="string">"is a food."</span>
    <span class="keyword">else:</span>
        <span class="keyword">print</span> name, <span class="string">"is a drink."</span>

<span class="comment-delimiter">#</span><span class="comment">=&gt; Banana is a food.
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Martini is a drink.
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>age = {}
age[<span class="string">"Toddler"</span>] = 3
age[<span class="string">"Unborn"</span>] = 0
age[<span class="string">"Phantasm"</span>] = <span class="py-pseudo-keyword">None</span>

<span class="keyword">for</span> thing <span class="keyword">in</span> (<span class="string">"Toddler"</span>, <span class="string">"Unborn"</span>, <span class="string">"Phantasm"</span>, <span class="string">"Relic"</span>):
    <span class="keyword">print</span> (<span class="string">"%s:"</span>%thing),
    <span class="keyword">if</span> thing <span class="keyword">in</span> age:
        <span class="keyword">print</span> <span class="string">"Exists"</span>,
        <span class="keyword">if</span> age[thing] <span class="keyword">is</span> <span class="keyword">not</span> <span class="py-pseudo-keyword">None</span>:
            <span class="keyword">print</span> <span class="string">"Defined"</span>,
        <span class="keyword">if</span> age[thing]:
            <span class="keyword">print</span> <span class="string">"True"</span>,
    <span class="keyword">print</span>
<span class="comment-delimiter">#</span><span class="comment">=&gt; Toddler: Exists Defined True
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Unborn: Exists Defined
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Phantasm: Exists
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Relic:
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">Get file sizes for the requested filenames
</span><span class="keyword">import</span> fileinput, os
size = {}
<span class="keyword">for</span> line <span class="keyword">in</span> fileinput.input():
    filename = line.rstrip()
    <span class="keyword">if</span> filename <span class="keyword">in</span> size:
        <span class="keyword">continue</span>
    size[filename] = os.path.getsize(filename)</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN241"
>Deleting from a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter"># </span><span class="comment">remove key and its value from mydict
</span><span class="keyword">del</span> mydict[key]
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">food_color as per Introduction
</span><span class="keyword">def</span> <span class="function-name">print_foods</span>():
    foods = food_color.keys()

    <span class="keyword">print</span> <span class="string">"Keys:"</span>, <span class="string">" "</span>.join(foods)
    <span class="keyword">print</span> <span class="string">"Values:"</span>,

    <span class="keyword">for</span> food <span class="keyword">in</span> foods:
        color = food_color[food]
        <span class="keyword">if</span> color <span class="keyword">is</span> <span class="keyword">not</span> <span class="py-pseudo-keyword">None</span>:
            <span class="keyword">print</span> color,
        <span class="keyword">else:</span>
            <span class="keyword">print</span> <span class="string">"(undef)"</span>,
    <span class="keyword">print</span>

<span class="keyword">print</span> <span class="string">"Initially:"</span>
print_foods()

<span class="keyword">print</span> <span class="string">"\nWith Banana set to None"</span>
food_color[<span class="string">"Banana"</span>] = <span class="py-pseudo-keyword">None</span>
print_foods()

<span class="keyword">print</span> <span class="string">"\nWith Banana deleted"</span>
<span class="keyword">del</span> food_color[<span class="string">"Banana"</span>]
print_foods()

<span class="comment-delimiter">#</span><span class="comment">=&gt; Initially:
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Keys: Carrot Lemon Apple Banana
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Values: orange yellow red yellow
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; 
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; With Banana set to None
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Keys: Carrot Lemon Apple Banana
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Values: orange yellow red (undef)
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; 
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; With Banana deleted
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Keys: Carrot Lemon Apple
</span><span class="comment-delimiter">#</span><span class="comment">=&gt; Values: orange yellow red
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">"Banana"</span>, <span class="string">"Apple"</span>, <span class="string">"Cabbage"</span>]:
    <span class="keyword">del</span> food_color[key]
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN244"
>Traversing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">for</span> key, value <span class="keyword">in</span> mydict.items():  
    <span class="keyword">pass</span> <span class="comment-delimiter"># </span><span class="comment">do something with key and value
</span>
<span class="comment-delimiter"># </span><span class="comment">If mydict is large, use iteritems() instead
</span><span class="keyword">for</span> key, value <span class="keyword">in</span> mydict.iteritems():  
    <span class="keyword">pass</span> <span class="comment-delimiter"># </span><span class="comment">do something with key and value
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS:
</span><span class="keyword">for</span> key <span class="keyword">in</span> mydict.keys():
    value = mydict[key]
    <span class="comment-delimiter"># </span><span class="comment">do something with key and value
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">food_color per the introduction
</span><span class="keyword">for</span> food, color <span class="keyword">in</span> food_color.items():
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % (food, color)

<span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS:
</span><span class="keyword">for</span> food <span class="keyword">in</span> food_color:
    color = food_color[food]
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % (food, color)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">print</span> <span class="string">"""%(food)s

is

%(color)s.
"""</span> % <span class="py-builtins">vars</span>()
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">for</span> food, color <span class="keyword">in</span> sorted(food_color.items()):
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % (food, color)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">!/usr/bin/env python
</span><span class="comment-delimiter"># </span><span class="comment">countfrom - count number of messages from each sender
</span>
<span class="keyword">import</span> sys
<span class="keyword">if</span> <span class="py-builtins">len</span>(sys.argv) &gt; 1:
    infile = <span class="py-builtins">open</span>(sys.argv[1])
<span class="keyword">else:</span>
    infile = sys.stdin

counts = {}
<span class="keyword">for</span> line <span class="keyword">in</span> infile:
    <span class="keyword">if</span> line.startswith(<span class="string">"From: "</span>):
        name = line[6:-1]
        counts[name] = counts.get(name, 0) + 1

<span class="keyword">for</span> (name, count) <span class="keyword">in</span> sorted(counts.items()):
    <span class="keyword">print</span> <span class="string">"%s: %s"</span> % (name, count)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN247"
>Printing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="keyword">for</span> key, val <span class="keyword">in</span> mydict.items():
    <span class="keyword">print</span> key, <span class="string">"=&gt;"</span>, val
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">print</span> <span class="string">"\n"</span>.join([(<span class="string">"%s =&gt; %s"</span> % item) <span class="keyword">for</span> item <span class="keyword">in</span> mydict.items()])
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">print</span> mydict
<span class="comment-delimiter">#</span><span class="comment">=&gt; {'firstname': 'Andrew', 'login': 'dalke', 'state': 'New Mexico', 'lastname': 'Dalke'}
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> pprint
pprint.pprint(dict)
<span class="comment-delimiter">#</span><span class="comment">=&gt; {'firstname': 'Andrew',
</span><span class="comment-delimiter">#</span><span class="comment">=&gt;  'lastname': 'Dalke',
</span><span class="comment-delimiter">#</span><span class="comment">=&gt;  'login': 'dalke',
</span><span class="comment-delimiter">#</span><span class="comment">=&gt;  'state': 'New Mexico'}
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN250"
>Retrieving from a Hash in Insertion Order</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">class</span> <span class="type">SequenceDict</span>(dict):
    <span class="string">"""
    Dictionary that remembers the insertion order.
    The lists returned by keys(), values() and items() are
    in the insertion order.
    """</span>
    <span class="keyword">def</span> <span class="function-name">__init__</span>(<span class="py-pseudo-keyword">self</span>, *args):
        <span class="py-pseudo-keyword">self</span>._keys={} <span class="comment-delimiter"># </span><span class="comment">key --&gt; id
</span>        <span class="py-pseudo-keyword">self</span>._ids={}      <span class="comment-delimiter"># </span><span class="comment">id  --&gt; key
</span>        <span class="py-pseudo-keyword">self</span>._next_id=0
        
    <span class="keyword">def</span> <span class="function-name">__setitem__</span>(<span class="py-pseudo-keyword">self</span>, key, value):
        <span class="py-pseudo-keyword">self</span>._keys[key]=<span class="py-pseudo-keyword">self</span>._next_id
        <span class="py-pseudo-keyword">self</span>._ids[<span class="py-pseudo-keyword">self</span>._next_id]=key
        <span class="py-pseudo-keyword">self</span>._next_id+=1
        <span class="keyword">return</span> dict.__setitem__(<span class="py-pseudo-keyword">self</span>, key, value)
    
    <span class="keyword">def</span> <span class="function-name">__delitem__</span>(<span class="py-pseudo-keyword">self</span>, key):
        id=<span class="py-pseudo-keyword">self</span>._keys[key]
        <span class="keyword">del</span>(<span class="py-pseudo-keyword">self</span>._keys[key])
        <span class="keyword">del</span>(<span class="py-pseudo-keyword">self</span>._ids[id])
        <span class="keyword">return</span> dict.__delitem__(<span class="py-pseudo-keyword">self</span>, key)

    <span class="keyword">def</span> <span class="function-name">values</span>(<span class="py-pseudo-keyword">self</span>):
        values=[]
        ids=<span class="py-builtins">list</span>(<span class="py-pseudo-keyword">self</span>._ids.items())
        ids.sort()
        <span class="keyword">for</span> id, key <span class="keyword">in</span> ids:
            values.append(<span class="py-pseudo-keyword">self</span>[key])
        <span class="keyword">return</span> values

    <span class="keyword">def</span> <span class="function-name">items</span>(<span class="py-pseudo-keyword">self</span>):
        items=[]
        ids=<span class="py-builtins">list</span>(<span class="py-pseudo-keyword">self</span>._ids.items())
        ids.sort()
        <span class="keyword">for</span> id, key <span class="keyword">in</span> ids:
            items.append((key, <span class="py-pseudo-keyword">self</span>[key]))
        <span class="keyword">return</span> items

    <span class="keyword">def</span> <span class="function-name">keys</span>(<span class="py-pseudo-keyword">self</span>):
        ids=<span class="py-builtins">list</span>(<span class="py-pseudo-keyword">self</span>._ids.items())
        ids.sort()
        keys=[]
        <span class="keyword">for</span> id, key <span class="keyword">in</span> ids:
            keys.append(key)
        <span class="keyword">return</span> keys

    <span class="keyword">def</span> <span class="function-name">update</span>(<span class="py-pseudo-keyword">self</span>, d):
        <span class="keyword">for</span> key, value <span class="keyword">in</span> d.items():
            <span class="py-pseudo-keyword">self</span>[key]=value

    <span class="keyword">def</span> <span class="function-name">clear</span>(<span class="py-pseudo-keyword">self</span>):
        dict.clear(<span class="py-pseudo-keyword">self</span>)
        <span class="py-pseudo-keyword">self</span>._keys={}
        <span class="py-pseudo-keyword">self</span>._ids={}
        <span class="py-pseudo-keyword">self</span>._next_id=0
        
<span class="keyword">def</span> <span class="function-name">testSequenceDict</span>():
    sd=SequenceDict()

    <span class="comment-delimiter"># </span><span class="comment">First Test
</span>    sd[3]=<span class="string">"first"</span>
    sd[2]=<span class="string">"second"</span>
    sd[1]=<span class="string">"third"</span>
    <span class="keyword">print</span> sd.keys()
    <span class="keyword">print</span> sd.items()
    <span class="keyword">print</span> sd.values()

    <span class="keyword">del</span>(sd[1])
    <span class="keyword">del</span>(sd[2])
    <span class="keyword">del</span>(sd[3])

    <span class="keyword">print</span> sd.keys(), sd.items(), sd.values()
    <span class="keyword">print</span> sd._ids, sd._keys

    <span class="keyword">print</span> <span class="string">"---------------"</span>
    <span class="comment-delimiter"># </span><span class="comment">Second Test
</span>    sd[<span class="string">"b"</span>]=<span class="string">"first"</span>
    sd[<span class="string">"a"</span>]=<span class="string">"second"</span>
    sd.update({<span class="string">"c"</span>: <span class="string">"third"</span>})
    <span class="keyword">print</span> sd.keys()
    <span class="keyword">print</span> sd.items()
    <span class="keyword">print</span> sd.values()

    <span class="keyword">del</span>(sd[<span class="string">"b"</span>])
    <span class="keyword">del</span>(sd[<span class="string">"a"</span>])
    <span class="keyword">del</span>(sd[<span class="string">"c"</span>])

    <span class="keyword">print</span> sd.keys(), sd.items(), sd.values()
    <span class="keyword">print</span> sd._ids, sd._keys

<span class="keyword">def</span> <span class="function-name">likePerlCookbook</span>():
    food_color=SequenceDict()
    food_color[<span class="string">"Banana"</span>]=<span class="string">"Yellow"</span>;
    food_color[<span class="string">"Apple"</span>]=<span class="string">"Green"</span>;
    food_color[<span class="string">"Lemon"</span>]=<span class="string">"Yellow"</span>
    <span class="keyword">print</span> <span class="string">"In insertion order, the foods' color are:"</span>
    <span class="keyword">for</span> food, color <span class="keyword">in</span> food_color.items():
        <span class="keyword">print</span> <span class="string">"%s is colored %s"</span> % (food, color)

<span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:
    <span class="comment-delimiter">#</span><span class="comment">testSequenceDict()
</span>    likePerlCookbook()
    </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN253"
>Hashes with Multiple Values Per Key</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="keyword">import</span> os
ttys = {}

who = os.popen(<span class="string">"who"</span>)

<span class="keyword">for</span> line <span class="keyword">in</span> who:
    user, tty = line.split()[:2]
    ttys.setdefault(user, []).append(tty)

<span class="keyword">for</span> (user, tty_list) <span class="keyword">in</span> sorted(ttys.items()):
    <span class="keyword">print</span> user + <span class="string">": "</span> + <span class="string">" "</span>.join(tty_list)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> pwd
<span class="keyword">for</span> (user, tty_list) <span class="keyword">in</span> ttys.items():
    <span class="keyword">print</span> user + <span class="string">":"</span>, <span class="py-builtins">len</span>(tty_list), <span class="string">"ttys."</span>
    <span class="keyword">for</span> tty <span class="keyword">in</span> sorted(tty_list):
        <span class="keyword">try:</span>
            uid = os.stat(<span class="string">"/dev/"</span> + tty).st_uid
            user = pwd.getpwuid(uid)[0]
        <span class="keyword">except</span> os.error:
            user = <span class="string">"(not available)"</span>
        <span class="keyword">print</span> <span class="string">"\t%s (owned by %s)"</span> % (tty, user)</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN256"
>Inverting a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter"># </span><span class="comment">lookup_dict maps keys to values
</span>reverse = <span class="py-builtins">dict</span>([(val, key) <span class="keyword">for</span> (key, val) <span class="keyword">in</span> lookup_dict.items()])
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>surname = {<span class="string">"Mickey"</span>: <span class="string">"Mantle"</span>, <span class="string">"Babe"</span>: <span class="string">"Ruth"</span>}
first_name = <span class="py-builtins">dict</span>([(last, first) <span class="keyword">for</span> (first, last) <span class="keyword">in</span> surname.items()])

<span class="keyword">print</span> first_name[<span class="string">"Mantle"</span>]
<span class="comment-delimiter">#</span><span class="comment">=&gt; Mickey
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">!/usr/bin/perl -w
</span><span class="comment-delimiter"># </span><span class="comment">foodfind - find match for food or color
</span>
<span class="keyword">import</span> sys
<span class="keyword">if</span> <span class="keyword">not</span> sys.argv[1:]:
    <span class="keyword">raise</span> <span class="py-builtins">SystemExit</span>(<span class="string">"usage: foodfind food_or_color"</span>)
given = sys.argv[1]

color_dict = {<span class="string">"Apple"</span>:  <span class="string">"red"</span>,
              <span class="string">"Banana"</span>: <span class="string">"yellow"</span>,
              <span class="string">"Lemon"</span>:  <span class="string">"yellow"</span>,
              <span class="string">"Carrot"</span>: <span class="string">"orange"</span>,
             }
food_dict = <span class="py-builtins">dict</span>([(color, food) <span class="keyword">for</span> (food, color) <span class="keyword">in</span> color_dict.items()])

<span class="keyword">if</span> given <span class="keyword">in</span> color_dict:
    <span class="keyword">print</span> given, <span class="string">"is a food with color"</span>, color_dict[given]
<span class="keyword">elif</span> given <span class="keyword">in</span> food_dict:
    <span class="keyword">print</span> food_dict[given], <span class="string">"is a food with color"</span>, given
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">food_color as per the introduction
</span>foods_with_color = {}
<span class="keyword">for</span> food, color <span class="keyword">in</span> food_color.items():
    foods_with_color.setdefault(color, []).append(food)

<span class="keyword">print</span> <span class="string">" "</span>.join(foods_with_color[<span class="string">"yellow"</span>]), <span class="string">"were yellow foods."</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN259"
>Sorting a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">mydict is the hash to sort
</span><span class="keyword">for</span> key, value <span class="keyword">in</span> sorted(mydict.items()):
    <span class="comment-delimiter"># </span><span class="comment">do something with key, value
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">food_color as per section 5.8
</span><span class="keyword">for</span> food, color <span class="keyword">in</span> sorted(food_color.items()):
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % (food, color)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">NOTE: alternative version
</span><span class="keyword">for</span> item <span class="keyword">in</span> sorted(food_color.items()):
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % item
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">NOTE: alternative version showing a user-defined function
</span><span class="keyword">def</span> <span class="function-name">food_cmp</span>(x, y):
    <span class="keyword">return</span> <span class="py-builtins">cmp</span>(x, y)

<span class="keyword">for</span> food, color <span class="keyword">in</span> sorted(food_color, cmp=food_cmp):
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % (food, color)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">def</span> <span class="function-name">food_len_cmp</span>(x, y):
    <span class="keyword">return</span> <span class="py-builtins">cmp</span>(len(x), <span class="py-builtins">len</span>(y))

<span class="keyword">for</span> food <span class="keyword">in</span> sorted(food_color, cmp=food_len_cmp):
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % (food, food_color[food])

<span class="comment-delimiter"># </span><span class="comment">In this instance, however, the following is both simpler and faster:
</span><span class="keyword">for</span> food <span class="keyword">in</span> sorted(food_color, key=len):
    <span class="keyword">print</span> <span class="string">"%s is %s."</span> % (food, food_color[food])
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN262"
>Merging Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>merged = {}
merged.update(a_dict)
merged.update(b_dict)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">NOTE: alternative version
</span>merged = a_dict.copy()
merged.update(b_dict)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS:
</span>
merged = {}
<span class="keyword">for</span> k, v <span class="keyword">in</span> a_dict.items():
    merged[k] = v
<span class="keyword">for</span> k, v <span class="keyword">in</span> b_dict.items():
    merged[k] = v
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">food_color as per section 5.8
</span>drink_color = {<span class="string">"Galliano"</span>: <span class="string">"yellow"</span>,
               <span class="string">"Mai Tai"</span>: <span class="string">"blue"</span>}

ingested_color = drink_color.copy()
ingested_color.update(food_color)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS:
</span>drink_color = {<span class="string">"Galliano"</span>: <span class="string">"yellow"</span>,
               <span class="string">"Mai Tai"</span>: <span class="string">"blue"</span>}

substance_color = {}
<span class="keyword">for</span> k, v <span class="keyword">in</span> food_color.items():
    substance_color[k] = v
<span class="keyword">for</span> k, v <span class="keyword">in</span> drink_color.items():
    substance_color[k] = v
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS:
</span>substance_color = {}
<span class="keyword">for</span> mydict <span class="keyword">in</span> (food_color, drink_color):
    <span class="keyword">for</span> k, v <span class="keyword">in</span> mydict:
        substance_color[k] = v
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS:
</span>substance_color = {}
<span class="keyword">for</span> item <span class="keyword">in</span> food_color.items() + drink_color.items():
    <span class="keyword">for</span> k, v <span class="keyword">in</span> mydict:
        substance_color[k] = v
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>substance_color = {}
<span class="keyword">for</span> mydict <span class="keyword">in</span> (food_color, drink_color):
    <span class="keyword">for</span> k, v <span class="keyword">in</span> mydict.items():
        <span class="keyword">if</span> substance_color.has_key(k):
            <span class="keyword">print</span> <span class="string">"Warning:"</span>, k, <span class="string">"seen twice.  Using the first definition."</span>
            <span class="keyword">continue</span>
        substance_color[k] = v

<span class="comment-delimiter"># </span><span class="comment">I think it's a copy, in which case
</span>all_colors = new_colors.copy()</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN265"
>Finding Common or Different Keys in Two Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>common = [k <span class="keyword">for</span> k <span class="keyword">in</span> dict1 <span class="keyword">if</span> k <span class="keyword">in</span> dict2]
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>this_not_that = [k <span class="keyword">for</span> k <span class="keyword">in</span> dict1 <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> dict2]
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">citrus_color is a dict mapping citrus food name to its color.
</span>citrus_color = {<span class="string">"Lemon"</span>:  <span class="string">"yellow"</span>,
                <span class="string">"Orange"</span>: <span class="string">"orange"</span>,
                <span class="string">"Lime"</span>:   <span class="string">"green"</span>}

<span class="comment-delimiter"># </span><span class="comment">build up a list of non-citrus foods
</span>non_citrus = [k <span class="keyword">for</span> k <span class="keyword">in</span> food_color <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> citruscolor]
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN268"
>Hashing References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">references as keys of dictionaries is no pb in python
</span>
name = {}
<span class="keyword">for</span> filename <span class="keyword">in</span> (<span class="string">"/etc/termcap"</span>, <span class="string">"/vmunix"</span>, <span class="string">"/bin/cat"</span>):
    <span class="keyword">try:</span>
        myfile = <span class="py-builtins">open</span>(filename)
    <span class="keyword">except</span> <span class="py-builtins">IOError</span>:
        <span class="keyword">pass</span>
    <span class="keyword">else:</span>
        names[myfile] = filename

<span class="keyword">print</span> <span class="string">"open files:"</span>, <span class="string">", "</span>.join(name.values())
<span class="keyword">for</span> f, fname <span class="keyword">in</span> name.items():
    f.seek(0, 2)       <span class="comment-delimiter"># </span><span class="comment">seek to the end
</span>    <span class="keyword">print</span> <span class="string">"%s is %d bytes long."</span> % (fname, f.tell())
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN271"
>Presizing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter"># </span><span class="comment">Python doesn't allow presizing of dicts, but hashing is efficient -
</span><span class="comment-delimiter"># </span><span class="comment">it only re-sizes at intervals, not every time an item is added.
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN274"
>Finding the Most Common Anything</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span>count = {}
<span class="keyword">for</span> element <span class="keyword">in</span> mylist:
    count[element] = count.get(element, 0) + 1</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN277"
>Representing Relationships Between Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> fileinput

father = {<span class="string">'Cain'</span>: <span class="string">'Adam'</span>,
          <span class="string">'Abel'</span>: <span class="string">'Adam'</span>,
          <span class="string">'Seth'</span>: <span class="string">'Adam'</span>,
          <span class="string">'Enoch'</span>: <span class="string">'Cain'</span>,
          <span class="string">'Irad'</span>: <span class="string">'Enoch'</span>,
          <span class="string">'Mehujael'</span>: <span class="string">'Irad'</span>,
          <span class="string">'Methusael'</span>: <span class="string">'Mehujael'</span>,
          <span class="string">'Lamech'</span>: <span class="string">'Methusael'</span>,
          <span class="string">'Jabal'</span>: <span class="string">'Lamech'</span>,
          <span class="string">'Tubalcain'</span>: <span class="string">'Lamech'</span>,
          <span class="string">'Enos'</span>: <span class="string">'Seth'</span>,
         }

<span class="keyword">for</span> line <span class="keyword">in</span> fileinput.input():
    person = line.rstrip()
    <span class="keyword">while</span> person:                    <span class="comment-delimiter"># </span><span class="comment">as long as we have people,
</span>        <span class="keyword">print</span> person,                <span class="comment-delimiter"># </span><span class="comment">print the current name
</span>        person = father.get(person)  <span class="comment-delimiter"># </span><span class="comment">set the person to the person's father
</span>    <span class="keyword">print</span>

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> fileinput

children = {}
<span class="keyword">for</span> k, v <span class="keyword">in</span> father.items():
    children.setdefault(v, []).append(k)

<span class="keyword">for</span> line <span class="keyword">in</span> fileinput.input():
    person = line.rstrip()
    kids = children.get(person, [<span class="string">"nobody"</span>])
    <span class="keyword">print</span> person, <span class="string">"begat"</span>, <span class="string">", "</span>.join(kids)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> sys, re
pattern = re.compile(r<span class="string">'^\s*#\s*include\s*&lt;([^&gt;]+)'</span>)
includes = {}
<span class="keyword">for</span> filename <span class="keyword">in</span> filenames:
    <span class="keyword">try:</span>
        infile = <span class="py-builtins">open</span>(filename)
    <span class="keyword">except</span> <span class="py-builtins">IOError</span>, err:
        print&gt;&gt;sys.stderr, err
        <span class="keyword">continue</span>
    <span class="keyword">for</span> line <span class="keyword">in</span> infile:
        match = pattern.match(line)
        <span class="keyword">if</span> match:
            includes.setdefault(match.group(1), []).append(filename)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">list of files that don't include others
</span>mydict = {}
<span class="keyword">for</span> e <span class="keyword">in</span> <span class="py-builtins">reduce</span>(<span class="keyword">lambda</span> a,b: a + b, includes.values()):
    <span class="keyword">if</span> <span class="keyword">not</span> includes.has_key(e):
        mydict[e] = 1
include_free = mydict.keys()
include_free.sort()</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN280"
>Program: dutree</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">!/usr/bin/env python -w
</span><span class="comment-delimiter"># </span><span class="comment">dutree - print sorted indented rendition of du output
</span><span class="keyword">import</span> os, sys

<span class="keyword">def</span> <span class="function-name">get_input</span>(args):
    <span class="comment-delimiter"># </span><span class="comment">NOTE: This is insecure - use only from trusted code!
</span>    cmd = <span class="string">"du "</span> + <span class="string">" "</span>.join(args)
    infile = os.popen(cmd)

    dirsize = {}
    kids = {}
    <span class="keyword">for</span> line <span class="keyword">in</span> infile:
        size, name = line[:-1].split(<span class="string">"\t"</span>, 1)
        dirsize[name] = <span class="py-builtins">int</span>(size)
        parent = os.path.dirname(name)
        kids.setdefault(parent, []).append(name)
    <span class="comment-delimiter"># </span><span class="comment">Remove the last field added, which is the root
</span>    kids[parent].pop()
    <span class="keyword">if</span> <span class="keyword">not</span> kids[parent]: 
        <span class="keyword">del</span> kids[parent]

    <span class="keyword">return</span> name, dirsize, kids

<span class="keyword">def</span> <span class="function-name">getdots</span>(root, dirsize, kids):
    size = cursize = dirsize[root]
    <span class="keyword">if</span> kids.has_key(root):
        <span class="keyword">for</span> kid <span class="keyword">in</span> kids[root]:
            cursize -= dirsize[kid]
            getdots(kid, dirsize, kids)
    <span class="keyword">if</span> size != cursize:
        dot = root + <span class="string">"/."</span>
        dirsize[dot] = cursize
        kids[root].append(dot)

<span class="keyword">def</span> <span class="function-name">output</span>(root, dirsize, kids, prefix = <span class="string">""</span>, width = 0):
    path = os.path.basename(root)
    size = dirsize[root]
    fmt = <span class="string">"%"</span> + <span class="py-builtins">str</span>(width) + <span class="string">"d %s"</span>
    line = fmt % (size, path)
    <span class="keyword">print</span> prefix + line

    prefix += (<span class="string">" "</span> * (width-1)) + <span class="string">"| "</span>  + (<span class="string">" "</span> * <span class="py-builtins">len</span>(path))

    <span class="keyword">if</span> kids.has_key(root):
        kid_list = kids[root]
        kid_list.sort(<span class="keyword">lambda</span> x, y, dirsize=dirsize:
                          <span class="py-builtins">cmp</span>(dirsize[x], dirsize[y]))
        width = <span class="py-builtins">len</span>(str(dirsize[kid_list[-1]]))
        <span class="keyword">for</span> kid <span class="keyword">in</span> kid_list:
            output(kid, dirsize, kids, prefix, width)

<span class="keyword">def</span> <span class="function-name">main</span>():
    root, dirsize, kids = get_input(sys.argv[1:])
    getdots(root, dirsize, kids)
    output(root, dirsize, kids)

<span class="keyword">if</span> <span class="py-builtins">__name__</span> == <span class="string">"__main__"</span>:
    main()</PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="patternmatching.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Arrays</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Pattern Matching</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>