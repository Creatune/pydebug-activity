<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Packages, Libraries, and Modules</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Python
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="References and Records"
HREF="referencesandrecords.html"><LINK
REL="NEXT"
TITLE="Classes, Objects, and Ties"
HREF="classesetc.html"><style type="text/css">    <!--
      .comment {
        /* font-lock-comment-face */
        color: #bebebe;
      }
      .comment-delimiter {
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b2dfee;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #ffa500;
      }
      .py-builtins {
        /* py-builtins-face */
        color: #ffa500;
      }
      .py-pseudo-keyword {
        /* py-pseudo-keyword-face */
        color: #ffa500;
      }
      .string {
        /* font-lock-string-face */
        color: #00cd00;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
    -->
    </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Python
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PACKAGESETC"
>12. Packages, Libraries, and Modules</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN642"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment"># Python's "module" is the closest equivalent to Perl's "package"
</span>

<span class="comment-delimiter">#</span><span class="comment">=== In the file "Alpha.py"
</span>name = <span class="string">"first"</span>

<span class="comment-delimiter">#</span><span class="comment">=== End of file
</span>
<span class="comment-delimiter">#</span><span class="comment">=== In the file "Omega.py"
</span>
name = <span class="string">"last"</span>
<span class="comment-delimiter">#</span><span class="comment">=== End of file
</span>
<span class="keyword">import</span> Alpha, Omega
<span class="keyword">print</span> <span class="string">"Alpha is %s, Omega is %s."</span> % (Alpha.name, Omega.name)
<span class="comment-delimiter">#</span><span class="comment">&gt; Alpha is first, Omega is last.
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">Python does not have an equivalent to "compile-time load"
</span><span class="keyword">import</span> sys

<span class="comment-delimiter"># </span><span class="comment">Depending on the implementation, this could use a builtin
</span><span class="comment-delimiter"># </span><span class="comment">module or load a file with the extension .py, .pyc, pyo, .pyd,
</span><span class="comment-delimiter"># </span><span class="comment">.so, .dll, or (with imputils) load from other files.
</span><span class="keyword">import</span> Cards.Poker

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">=== In the file Cards/Poker.py
</span>__all__ = [<span class="string">"card_deck"</span>, <span class="string">"shuffle"</span>]  <span class="comment-delimiter"># </span><span class="comment">not usually needed
</span>card_deck = []
<span class="keyword">def</span> <span class="function-name">shuffle</span>():
    <span class="keyword">pass</span>

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN645"
>Defining a Module's Interface</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">== In the file "YourModule.py"
</span>
__version__ = (1, 0)          <span class="comment-delimiter"># </span><span class="comment">Or higher
</span>__all__ = [<span class="string">"..."</span>, <span class="string">"..."</span>]      <span class="comment-delimiter"># </span><span class="comment">Override names included in "... import *"
</span>                              <span class="comment-delimiter">#   </span><span class="comment">Note: 'import *' is considered poor style
</span>                              <span class="comment-delimiter">#   </span><span class="comment">and it is rare to use this variable.
</span><span class="comment-delimiter">#</span><span class="comment">#######################
</span><span class="comment-delimiter"># </span><span class="comment">your code goes here
</span><span class="comment-delimiter">#</span><span class="comment">#######################
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> YourModule             <span class="comment-delimiter"># </span><span class="comment">Import the module into my package
</span>                              <span class="comment-delimiter">#  </span><span class="comment">(does not import any of its symbols)
</span>
<span class="keyword">import</span> YourModule <span class="keyword">as</span> Module   <span class="comment-delimiter"># </span><span class="comment">Use a different name for the module
</span>
<span class="keyword">from</span> YourModule <span class="keyword">import</span> *      <span class="comment-delimiter"># </span><span class="comment">Import all module symbols not starting
</span>                              <span class="comment-delimiter">#  </span><span class="comment">with an underscore (default); if __all__
</span>                              <span class="comment-delimiter">#  </span><span class="comment">is defined, only imports those symbols.
</span>                              <span class="comment-delimiter"># </span><span class="comment">Using this is discouraged unless the 
</span>                              <span class="comment-delimiter">#  </span><span class="comment">module is specifically designed for it.
</span>
<span class="keyword">from</span> YourModule <span class="keyword">import</span> name1, name2, xxx
                              <span class="comment-delimiter"># </span><span class="comment">Import the named symbols from the module
</span>
<span class="keyword">from</span> YourModule <span class="keyword">import</span> name1 <span class="keyword">as</span> name2
                              <span class="comment-delimiter"># </span><span class="comment">Import the named object, but use a
</span>                              <span class="comment-delimiter">#  </span><span class="comment">different name to access it locally.
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>__all__ = [<span class="string">"F1"</span>, <span class="string">"F2"</span>, <span class="string">"List"</span>]
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>__all__ = [<span class="string">"Op_Func"</span>, <span class="string">"Table"</span>]
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">from</span> YourModule <span class="keyword">import</span> Op_Func, Table, F1
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">from</span> YourModule <span class="keyword">import</span> Functions, Table
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN648"
>Trapping Errors in require or use</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">no import
</span>mod = <span class="string">"module"</span>
<span class="keyword">try:</span>
    <span class="py-builtins">__import__</span>(mod)
<span class="keyword">except</span> <span class="py-builtins">ImportError</span>, err:
    <span class="keyword">raise</span> <span class="py-builtins">ImportError</span>(<span class="string">"couldn't load %s: %s"</span> % (mod, err))

<span class="comment-delimiter"># </span><span class="comment">imports into current package
</span><span class="keyword">try:</span>
    <span class="keyword">import</span> module
<span class="keyword">except</span> <span class="py-builtins">ImportError</span>, err:
    <span class="keyword">raise</span> <span class="py-builtins">ImportError</span>(<span class="string">"couldn't load 'module': %s"</span> % (err, ))

<span class="comment-delimiter"># </span><span class="comment">imports into current package, if the name is known
</span><span class="keyword">try:</span>
    <span class="keyword">import</span> module
<span class="keyword">except</span> <span class="py-builtins">ImportError</span>, err:
    <span class="keyword">raise</span> <span class="py-builtins">ImportError</span>(<span class="string">"couldn't load 'module': %s"</span> % (err, ))

<span class="comment-delimiter"># </span><span class="comment">Use a fixed local name for a named module
</span>mod = <span class="string">"module"</span>
<span class="keyword">try:</span>
    local_name = <span class="py-builtins">__import__</span>(mod)
<span class="keyword">except</span> <span class="py-builtins">ImportError</span>, err:
    <span class="keyword">raise</span> <span class="py-builtins">ImportError</span>(<span class="string">"couldn't load %s: %s"</span> % (mod, err))

<span class="comment-delimiter"># </span><span class="comment">Use the given name for the named module.
</span><span class="comment-delimiter"># </span><span class="comment">(You probably don't need to do this.)
</span>mod = <span class="string">"module"</span>
<span class="keyword">try:</span>
    <span class="py-builtins">globals</span>()[mod] = <span class="py-builtins">__import__</span>(mod)
<span class="keyword">except</span> <span class="py-builtins">ImportError</span>, err:
    <span class="keyword">raise</span> <span class="py-builtins">ImportError</span>(<span class="string">"couldn't load %s: %s"</span> % (mod, err))

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>DBs = <span class="string">"Giant.Eenie Giant.Meanie Mouse.Mynie Moe"</span>.split()
<span class="keyword">for</span> mod <span class="keyword">in</span> DBs.split():
    <span class="keyword">try:</span>
        loaded_module = <span class="py-builtins">__import__</span>(mod)
    <span class="keyword">except</span> <span class="py-builtins">ImportError</span>:
        <span class="keyword">continue</span>
    <span class="comment-delimiter"># </span><span class="comment">__import__ returns a reference to the top-most module
</span>    <span class="comment-delimiter"># </span><span class="comment">Need to get the actual submodule requested.
</span>    <span class="keyword">for</span> term <span class="keyword">in</span> mod.split(<span class="string">"."</span>)[:-1]:
        loaded_module = <span class="py-builtins">getattr</span>(loaded_module, term)
    <span class="keyword">break</span>
<span class="keyword">else:</span>
    <span class="keyword">raise</span> <span class="py-builtins">ImportError</span>(<span class="string">"None of %s loaded"</span> % DBs)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN651"
>Delaying use Until Run Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> sys
<span class="keyword">if</span> <span class="py-builtins">__name__</span> == <span class="string">"__main__"</span>:
    <span class="keyword">if</span> <span class="py-builtins">len</span>(sys.argv) != 3 <span class="keyword">or</span> <span class="keyword">not</span> sys.argv[1].isdigit() \
                          <span class="keyword">or</span> <span class="keyword">not</span> sys.argv[2].isdigit():
        <span class="keyword">raise</span> <span class="py-builtins">SystemExit</span>(<span class="string">"usage: %s num1 num2"</span> % sys.argv[0])

<span class="keyword">import</span> Some.Module
<span class="keyword">import</span> More.Modules
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">if</span> opt_b:
    <span class="keyword">import</span> math
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">from</span> os <span class="keyword">import</span> O_EXCL, O_CREAT, O_RDWR

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> os
O_EXCL = os.O_EXCL
O_CREAT = os.O_CREAT
O_RDWR = os.O_RDWR
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> os
O_EXCL, O_CREAT, O_RDWR = os.O_EXCL, os.O_CREAT, os.O_RDWR
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>load_module(<span class="string">'os'</span>, <span class="string">"O_EXCL O_CREAT O_RDWR"</span>.split())

<span class="keyword">def</span> <span class="function-name">load_module</span>(module_name, symbols):
    module = <span class="py-builtins">__import__</span>(module_name)
    <span class="keyword">for</span> symbol <span class="keyword">in</span> symbols:
        <span class="py-builtins">globals</span>()[symbol] = <span class="py-builtins">getattr</span>(module, symbol)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN654"
>Making Variables Private to a Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">Python doesn't have Perl-style packages
</span>
<span class="comment-delimiter"># </span><span class="comment">Flipper.py
</span>__version__ = (1, 0)

__all__ = [<span class="string">"flip_boundary"</span>, <span class="string">"flip_words"</span>]

Separatrix = <span class="string">' '</span>  <span class="comment-delimiter"># </span><span class="comment">default to blank
</span>
<span class="keyword">def</span> <span class="function-name">flip_boundary</span>(sep = <span class="py-pseudo-keyword">None</span>):
    prev_sep = Separatrix
    <span class="keyword">if</span> sep <span class="keyword">is</span> <span class="keyword">not</span> <span class="py-pseudo-keyword">None</span>:
        <span class="keyword">global</span> Separatrix
        Separatrix = sep
    <span class="keyword">return</span> prev_sep

<span class="keyword">def</span> <span class="function-name">flip_words</span>(line):
    words = line.split(Separatrix)
    words.reverse()
    <span class="keyword">return</span> Separatrix.join(words)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN657"
>Determining the Caller's Package</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>this_pack = <span class="py-builtins">__name__</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>that_pack = sys._getframe(1).f_globals.get(<span class="string">"__name__"</span>, <span class="string">"&lt;string&gt;"</span>)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">print</span> <span class="string">"I am in package"</span>, <span class="py-builtins">__name__</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">def</span> <span class="function-name">nreadline</span>(count, myfile):
    <span class="keyword">if</span> count &lt;= 0:
        <span class="keyword">raise</span> <span class="py-builtins">ValueError</span>(<span class="string">"Count must be &gt; 0"</span>)
    <span class="keyword">return</span> [myfile.readline() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="py-builtins">range</span>(count)]

<span class="keyword">def</span> <span class="function-name">main</span>():
    myfile = <span class="py-builtins">open</span>(<span class="string">"/etc/termcap"</span>)
    a, b, c = nreadline(3, myfile)
    myfile.close()

<span class="keyword">if</span> <span class="py-builtins">__name__</span> == <span class="string">"__main__"</span>:
    main()

<span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS:
</span><span class="keyword">import</span> sys

<span class="keyword">def</span> <span class="function-name">nreadline</span>(count, handle_name):
    <span class="keyword">assert</span> count &gt; 0, <span class="string">"count must be &gt; 0"</span>
    <span class="py-builtins">locals</span> = sys._getframe(1).f_locals
    <span class="keyword">if</span> <span class="keyword">not</span> locals.has_key(handle_name):
        <span class="keyword">raise</span> <span class="py-builtins">AssertionError</span>(<span class="string">"need open filehandle"</span>)
    infile = locals[handle_name]
    retlist = []
    <span class="keyword">for</span> line <span class="keyword">in</span> infile:
        retlist.append(line)
        count -= 1
        <span class="keyword">if</span> count == 0:
            <span class="keyword">break</span>
    <span class="keyword">return</span> retlist

<span class="keyword">def</span> <span class="function-name">main</span>():
    FH = <span class="py-builtins">open</span>(<span class="string">"/etc/termcap"</span>)
    a, b, c = nreadline(3, <span class="string">"FH"</span>)

<span class="keyword">if</span> <span class="py-builtins">__name__</span> == <span class="string">"__main__"</span>:
    main()
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN660"
>Automating Module Clean-Up</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment"># There is no direct equivalent in Python to an END block
</span><span class="keyword">import</span> time, os, sys

<span class="comment-delimiter"># </span><span class="comment">Tricks to ensure the needed functions exist during module cleanup
</span><span class="keyword">def</span> <span class="function-name">_getgmtime</span>(asctime=time.asctime, gmtime=time.gmtime,
               t=time.time):
    <span class="keyword">return</span> asctime(gmtime(t()))

<span class="keyword">class</span> <span class="type">Logfile</span>:
    <span class="keyword">def</span> <span class="function-name">__init__</span>(<span class="py-pseudo-keyword">self</span>, file):
        <span class="py-pseudo-keyword">self</span>.file = <span class="py-builtins">file</span>

    <span class="keyword">def</span> <span class="function-name">_logmsg</span>(<span class="py-pseudo-keyword">self</span>, msg, argv0=sys.argv[0], pid=os.getpid(),
                _getgmtime=_getgmtime):
        <span class="comment-delimiter"># </span><span class="comment">more tricks to keep all needed references
</span>        now = _getgmtime()
        print&gt;&gt;<span class="py-pseudo-keyword">self</span>.file, argv0, pid, now + <span class="string">":"</span>, msg

    <span class="keyword">def</span> <span class="function-name">logmsg</span>(<span class="py-pseudo-keyword">self</span>, msg):
        <span class="py-pseudo-keyword">self</span>._logmsg(<span class="py-pseudo-keyword">self</span>.file, msg)

    <span class="keyword">def</span> <span class="function-name">__del__</span>(<span class="py-pseudo-keyword">self</span>):
        <span class="py-pseudo-keyword">self</span>._logmsg(<span class="string">"shutdown"</span>)
        <span class="py-pseudo-keyword">self</span>.file.close()

    <span class="keyword">def</span> <span class="function-name">__getattr__</span>(<span class="py-pseudo-keyword">self</span>, attr):
        <span class="comment-delimiter"># </span><span class="comment">forward everything else to the file handle
</span>        <span class="keyword">return</span> <span class="py-builtins">getattr</span>(<span class="py-pseudo-keyword">self</span>.file, attr)

<span class="comment-delimiter"># </span><span class="comment">0 means unbuffered
</span>LF = Logfile(<span class="py-builtins">open</span>(<span class="string">"/tmp/mylog"</span>, <span class="string">"a+"</span>, 0))
logmsg = LF.logmsg

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment"># It is more appropriate to use try/finally around the
</span><span class="comment-delimiter">#</span><span class="comment"># main code, so the order of initialization and finalization
</span><span class="comment-delimiter">#</span><span class="comment"># can be specified.
</span><span class="keyword">if</span> <span class="py-builtins">__name__</span> == <span class="string">"__main__"</span>:
    <span class="keyword">import</span> logger
    logger.init(<span class="string">"/tmp/mylog"</span>)
    <span class="keyword">try:</span>
        main()
    <span class="keyword">finally:</span>
        logger.close()

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN663"
>Keeping Your Own Module Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">% python -c 'import sys\
</span><span class="keyword">for</span> i, name <span class="keyword">in</span> <span class="py-builtins">zip</span>(xrange(sys.maxint), sys.path):\
    <span class="keyword">print</span> i, <span class="py-builtins">repr</span>(name)
<span class="comment-delimiter">#</span><span class="comment">&gt; 0 ''
</span><span class="comment-delimiter">#</span><span class="comment">&gt; 1 '/usr/lib/python2.2'
</span><span class="comment-delimiter">#</span><span class="comment">&gt; 2 '/usr/lib/python2.2/plat-linux2'
</span><span class="comment-delimiter">#</span><span class="comment">&gt; 3 '/usr/lib/python2.2/lib-tk'
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">syntax for sh, bash, ksh, or zsh
</span><span class="comment-delimiter">#</span><span class="comment">$ export PYTHONPATH=$HOME/pythonlib
</span>
<span class="comment-delimiter"># </span><span class="comment">syntax for csh or tcsh
</span><span class="comment-delimiter">#</span><span class="comment">% setenv PYTHONPATH ~/pythonlib
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> sys
sys.path.insert(0, <span class="string">"/projects/spectre/lib"</span>)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> FindBin
sys.path.insert(0, FindBin.Bin)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> FindBin
Bin = <span class="string">"Name"</span>
bin = <span class="py-builtins">getattr</span>(FindBin, Bin)
sys.path.insert(0, bin + <span class="string">"/../lib"</span>)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN666"
>Preparing a Module for Distribution</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">% h2xs -XA -n Planets
</span><span class="comment-delimiter">#</span><span class="comment">% h2xs -XA -n Astronomy::Orbits
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">@@INCOMPLETE@@
</span><span class="comment-delimiter"># </span><span class="comment">@@INCOMPLETE@@
</span><span class="comment-delimiter"># </span><span class="comment">Need a distutils example
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN669"
>Speeding Module Loading with SelfLoader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">Python compiles a file to bytecode the first time it is imported and 
</span><span class="comment-delimiter"># </span><span class="comment">stores this compiled form in a .pyc file.  There is thus less need for
</span><span class="comment-delimiter"># </span><span class="comment">incremental compilation as once there is a .pyc file, the sourcecode
</span><span class="comment-delimiter"># </span><span class="comment">is only recompiled if it is modified.  
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN672"
>Speeding Up Module Loading with Autoloader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">See previous section
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN675"
>Overriding Built-In Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment"># Any definition in a Python module overrides the builtin
</span><span class="comment-delimiter">#</span><span class="comment"># for that module
</span>
<span class="comment-delimiter">#</span><span class="comment">=== In MyModule
</span><span class="keyword">def</span> <span class="py-builtins">open</span>():
    <span class="keyword">pass</span> <span class="comment-delimiter"># </span><span class="comment">TBA
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">from</span> MyModule <span class="keyword">import</span> <span class="py-builtins">open</span>
<span class="py-builtins">file</span> = <span class="py-builtins">open</span>()
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN678"
>Reporting Errors and Warnings Like Built-Ins</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">def</span> <span class="function-name">even_only</span>(n):
    <span class="keyword">if</span> n &amp; 1:     <span class="comment-delimiter"># </span><span class="comment">one way to test
</span>        <span class="keyword">raise</span> <span class="py-builtins">AssertionError</span>(<span class="string">"%s is not even"</span> % (n,))
    <span class="comment-delimiter">#</span><span class="comment">....
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">def</span> <span class="function-name">even_only</span>(n):
    <span class="keyword">if</span> n % 2:    <span class="comment-delimiter"># </span><span class="comment">here's another
</span>        <span class="comment-delimiter"># </span><span class="comment">choice of exception depends on the problem
</span>        <span class="keyword">raise</span> <span class="py-builtins">TypeError</span>(<span class="string">"%s is not even"</span> % (n,))
    <span class="comment-delimiter">#</span><span class="comment">....
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> warnings
<span class="keyword">def</span> <span class="function-name">even_only</span>(n):
    <span class="keyword">if</span> n &amp; 1:           <span class="comment-delimiter"># </span><span class="comment">test whether odd number
</span>        warnings.warn(<span class="string">"%s is not even, continuing"</span> % (n))
        n += 1
    <span class="comment-delimiter">#</span><span class="comment">....
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>warnings.filterwarnings(<span class="string">"ignore"</span>)
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN681"
>Referring to Packages Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>val = <span class="py-builtins">getattr</span>(__import__(packname), varname)
vals =  <span class="py-builtins">getattr</span>(__import__(packname), aryname)
<span class="py-builtins">getattr</span>(__import__(packname), funcname)(<span class="string">"args"</span>)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS [Use math.log(val, base) instead]
</span><span class="keyword">import</span> math
<span class="keyword">def</span> <span class="function-name">make_log</span>(n):
   <span class="keyword">def</span> <span class="function-name">logn</span>(val):
      <span class="keyword">return</span> math.log(val, n)
   <span class="keyword">return</span> logn

<span class="comment-delimiter"># </span><span class="comment">Modifying the global dictionary - this could also be done
</span><span class="comment-delimiter"># </span><span class="comment">using locals(), or someobject.__dict__
</span>globaldict = <span class="py-builtins">globals</span>()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="py-builtins">range</span>(2, 1000):
    globaldict[<span class="string">"log%s"</span>%i] = make_log(i)

<span class="comment-delimiter"># </span><span class="comment">DON'T DO THIS
</span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="py-builtins">range</span>(2,1000):
    <span class="keyword">exec</span> <span class="string">"log%s = make_log(i)"</span>%i <span class="keyword">in</span> <span class="py-builtins">globals</span>()
    
<span class="keyword">print</span> log20(400)
<span class="comment-delimiter">#</span><span class="comment">=&gt;2.0
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span>blue = colours.blue
someobject.blue = colours.azure  <span class="comment-delimiter"># </span><span class="comment">someobject could be a module...
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN684"
>Using h2ph to Translate C #include Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">Python extension modules can be imported and used just like
</span><span class="comment-delimiter"># </span><span class="comment">a pure python module.
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">See http://www.cosc.canterbury.ac.nz/~greg/python/Pyrex/ for
</span><span class="comment-delimiter"># </span><span class="comment">information on how to create extension modules in Pyrex [a
</span><span class="comment-delimiter"># </span><span class="comment">language that's basically Python with type definitions which
</span><span class="comment-delimiter"># </span><span class="comment">converts to compiled C code]
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">See http://www.boost.org/libs/python/doc/ for information on how
</span><span class="comment-delimiter"># </span><span class="comment">to create extension modules in C++.
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">See http://www.swig.org/Doc1.3/Python.html for information on how
</span><span class="comment-delimiter"># </span><span class="comment">to create extension modules in C/C++
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">See http://docs.python.org/ext/ext.html for information on how to
</span><span class="comment-delimiter"># </span><span class="comment">create extension modules in C/C++ (manual reference count management).
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">See http://cens.ioc.ee/projects/f2py2e/ for information on how to
</span><span class="comment-delimiter"># </span><span class="comment">create extension modules in Fortran
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">See http://www.scipy.org/Weave for information on how to 
</span><span class="comment-delimiter"># </span><span class="comment">include inline C code in Python code.
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">@@INCOMPLETE@@ Need examples of FineTime extensions using the different methods...
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN687"
>Using h2xs to Make a Module with C Code</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">See previous section
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN690"
>Documenting Your Module with Pod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">To document code, use docstrings. A docstring is a bare string that
</span><span class="comment-delimiter"># </span><span class="comment">is placed at the beginning of a module or immediately after the 
</span><span class="comment-delimiter"># </span><span class="comment">definition line of a class, method, or function. Normally, the
</span><span class="comment-delimiter"># </span><span class="comment">first line is a brief description of the object; if a longer
</span><span class="comment-delimiter"># </span><span class="comment">description is needed, it commences on the third line (the second
</span><span class="comment-delimiter"># </span><span class="comment">line being left blank).  Multiline comments should use triple
</span><span class="comment-delimiter"># </span><span class="comment">quoted strings.
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">Docstrings are automagically assigned to an object's __doc__ property.
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">In other words these three classes are identical:
</span><span class="keyword">class</span> <span class="type">Foo</span>(object):
    <span class="string">"A class demonstrating docstrings."</span>

<span class="keyword">class</span> <span class="type">Foo</span>(object):
    __doc__ = <span class="string">"A class demonstrating docstrings."</span>

<span class="keyword">class</span> <span class="type">Foo</span>(object):
    <span class="keyword">pass</span>
Foo.__doc__ = <span class="string">"A class demonstrating docstrings."</span>

<span class="comment-delimiter"># </span><span class="comment">as are these two functions:
</span><span class="keyword">def</span> <span class="function-name">foo</span>():
    <span class="string">"A function demonstrating docstrings."</span>

<span class="keyword">def</span> <span class="function-name">foo</span>():
    <span class="keyword">pass</span>
foo.__doc__ = <span class="string">"A function demonstrating docstrings."</span>

<span class="comment-delimiter"># </span><span class="comment">the pydoc module is used to display a range of information about 
</span><span class="comment-delimiter"># </span><span class="comment">an object including its docstrings:
</span><span class="keyword">import</span> pydoc 
<span class="keyword">print</span> pydoc.getdoc(int)
pydoc.help(int)

<span class="comment-delimiter"># </span><span class="comment">In the interactive interpreter, objects' documentation can be 
</span><span class="comment-delimiter"># </span><span class="comment">using the help function:
</span>help(int)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN693"
>Building and Installing a CPAN Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">Recent Python distributions are built and installed with disutils.
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">To build and install under unix
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">% python setup.py install
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">If you want to build under one login and install under another
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">% python setup.py build
</span><span class="comment-delimiter"># </span><span class="comment">$ python setup.py install
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">A package may also be available prebuilt, eg, as an RPM or Windows
</span><span class="comment-delimiter"># </span><span class="comment">installer.  Details will be specific to the operating system.
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter"># </span><span class="comment">% python setup.py --prefix ~/python-lib
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN696"
>Example: Module Template</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">== File Some/Module.py
</span>
<span class="comment-delimiter"># </span><span class="comment">There are so many differences between Python and Perl that
</span><span class="comment-delimiter"># </span><span class="comment">it isn't worthwhile trying to come up with an equivalent to
</span><span class="comment-delimiter"># </span><span class="comment">this Perl code.  The Python code is much smaller, and there's
</span><span class="comment-delimiter"># </span><span class="comment">no need to have a template.
</span>
<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN699"
>Program: Finding Versions and Descriptions of Installed Modules</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="comment-delimiter"></span><span class="comment"></span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="comment-delimiter">#</span><span class="comment">% pmdesc
</span><span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span><span class="keyword">import</span> sys, pydoc

<span class="keyword">def</span> <span class="function-name">print_module_info</span>(path, modname, desc):
   <span class="comment-delimiter"># </span><span class="comment">Skip files starting with "test_"
</span>   <span class="keyword">if</span> modname.split(<span class="string">"."</span>)[-1].startswith(<span class="string">"test_"</span>):
       <span class="keyword">return</span>
   <span class="keyword">try:</span>
       <span class="comment-delimiter"># </span><span class="comment">This assumes the modules are safe for importing,
</span>       <span class="comment-delimiter"># </span><span class="comment">in that they don't have side effects.  Could also
</span>       <span class="comment-delimiter"># </span><span class="comment">grep the file for the __version__ line.
</span>       mod = pydoc.safeimport(modname)
   <span class="keyword">except</span> pydoc.ErrorDuringImport:
       <span class="keyword">return</span>
   version = <span class="py-builtins">getattr</span>(mod, <span class="string">"__version__"</span>, <span class="string">"unknown"</span>)
   <span class="keyword">if</span> <span class="py-builtins">isinstance</span>(version, <span class="py-builtins">type</span>(<span class="string">""</span>)):
       <span class="comment-delimiter"># </span><span class="comment">Use the string if it's given
</span>       <span class="keyword">pass</span>
   <span class="keyword">else:</span>
       <span class="comment-delimiter"># </span><span class="comment">Assume it's a list of version numbers, from major to minor
</span>       <span class="string">"."</span>.join(<span class="py-builtins">map</span>(str, version))
   synopsis, text = pydoc.splitdoc(desc)
   <span class="keyword">print</span> <span class="string">"%s (%s) - %s"</span> % (modname, version, synopsis)

scanner = pydoc.ModuleScanner()
scanner.run(print_module_info)

<span class="comment-delimiter">#</span><span class="comment">-----------------------------
</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>References and Records</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Classes, Objects, and Ties</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>